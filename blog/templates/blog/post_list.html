{% extends 'base.html' %}
{% block title %}Home{% endblock %}

{% block content %}
  <section class="mb-6 flex items-center justify-between">
    <div>
      <h1 class="title">Latest Posts</h1>
      <p class="mt-1 muted">Fresh thoughts with glowing edges.</p>
    </div>
    {% if user.is_authenticated %}
      <a href="{% url 'make_post' %}" class="btn">Create New Post</a>
    {% endif %}
  </section>

  {% if posts %}
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for post in posts %}
        <article id="post-{{ post.id }}" class="card p-5 hover:shadow-neon transition relative">
          <a href="{% url 'post_detail' post.slug %}" class="absolute inset-0" aria-label="Open post"></a>

          <div class="mb-3 text-sm muted">
            <span>{{ post.created_at|date:"M j, Y" }}</span>
          </div>

          <h2 class="text-xl font-semibold pr-10">{{ post.title }}</h2>
          <p class="mt-2 line-clamp-3 text-white/80">{{ post.body }}</p>

          <div class="mt-4 flex items-center justify-between text-sm">
            <span class="muted">by <span class="text-white/90">{{ post.author }}</span></span>

            <!-- Like form -->
            <form action="{% url 'like_post' slug=post.slug %}" method="post" class="relative z-10">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}#post-{{ post.id }}">
              {% if user in post.likes.all %}
                <button type="submit" title="Unlike" class="px-3 py-2 rounded-lg bg-rose/20 border border-rose/30 hover:bg-rose/30 transition">
                  <i class="fa-solid fa-heart"></i>
                </button>
                <span class="ml-2">{{ post.likes.count }} Likes</span>
              {% else %}
                <button type="submit" title="Like" class="px-3 py-2 rounded-lg bg-white/5 border border-white/15 hover:border-white/30 transition">
                  <i class="fa-regular fa-heart"></i>
                </button>
              {% endif %}
            </form>
          </div>

          {% if request.user.is_authenticated and request.user == post.author %}
            <div class="mt-4 relative z-10 flex gap-2">
              <a href="{% url 'post_edit' post.slug %}" class="px-3 py-1 rounded-lg btn-outline">Edit</a>
              <a href="{% url 'delete_post' post.slug %}" class="px-3 py-1 rounded-lg bg-rose/20 border border-rose/30 hover:bg-rose/30">Delete</a>
            </div>
          {% endif %}
        </article>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="mt-8 flex items-center justify-center gap-3">
      {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}" class="px-3 py-2 rounded-lg btn-outline">Previous</a>
      {% endif %}
      <span class="px-3 py-2 rounded-lg bg-white/5 border border-white/10">
        Page {{ posts.number }} of {{ posts.paginator.num_pages }}
      </span>
      {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}" class="px-3 py-2 rounded-lg btn-outline">Next</a>
      {% endif %}
    </div>
  {% else %}
    <div class="card p-6">
      <p class="text-white/80">No posts yet. Be the first to publish!</p>
    </div>
  {% endif %}
{% endblock %}
